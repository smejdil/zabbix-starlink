zabbix_export:
  version: '6.4'
  template_groups:
    -
      uuid: 7df96b18c230490a9a0a9e2307226338
      name: Templates
  templates:
    -
      uuid: 259e8a259c4043c5bd8d29d5d7cf6f4c
      template: 'Starlink dish by Prom'
      name: 'Starlink dish by Prom'
      description: |
        Use project Python starlink-grpc-tools
        
        https://github.com/sparky8512/starlink-grpc-tools
        
        Run Starlink exporter:
        python dish_grpc_prometheus.py status
      vendor:
        name: Open-Tech
        version: 6.4-0
      groups:
        -
          name: Templates
      items:
        -
          uuid: 0db5bc43793d41e5af87c31cf7fa1c91
          name: 'Starlink alerts'
          type: DEPENDENT
          key: starlink.alerts
          delay: '0'
          value_type: FLOAT
          description: 'A bit field combining all active alerts, where a 1 bit indicates the alert is active. See alert detail status data for which bits correspond with each alert, or to get individual alert flags instead of a combined bit mask.'
          valuemap:
            name: 'Starlink alerts'
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_alerts"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: alert
          triggers:
            -
              uuid: bf7bf8f51344437a9007885b34dd345b
              expression: 'last(/Starlink dish by Prom/starlink.alerts,#3)>0'
              name: 'Starlink alert'
              opdata: 'Current value: {ITEM.LASTVALUE1}'
              priority: INFO
              description: 'Starlink alert. Ack to close'
              manual_close: 'YES'
              dependencies:
                -
                  name: 'Starlink alert install pending'
                  expression: 'last(/Starlink dish by Prom/starlink.alerts,#3)=128'
              tags:
                -
                  tag: scope
                  value: notice
            -
              uuid: 6997bc4c2a80414d8f71a77e72154e43
              expression: 'last(/Starlink dish by Prom/starlink.alerts,#3)=128'
              name: 'Starlink alert install pending'
              opdata: 'Current value: {ITEM.LASTVALUE1}'
              priority: WARNING
              description: 'Starlink alert install pending. Ack to close'
              manual_close: 'YES'
              tags:
                -
                  tag: scope
                  value: notice
        -
          uuid: 9eac4dc3aedb4c899d5be9497caf3697
          name: 'Starlink currently obstructed'
          type: DEPENDENT
          key: starlink.currently_obstructed
          delay: '0'
          value_type: FLOAT
          description: 'Most recent sample value. See *obstructed* in bulk history data for detail. This item still appears to be reported by the user terminal despite no longer appearing in the bulk history data.'
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_currently_obstructed"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: obstructed
        -
          uuid: 9f5dcf3dadf749149cf2bf3f174fe108
          name: 'Starlink direction azimuth'
          type: DEPENDENT
          key: starlink.direction_azimuth
          delay: '0'
          value_type: FLOAT
          description: 'Azimuth angle, in degrees, of the direction in which the user terminal''s dish antenna is physically pointing. Note that this generally is not the exact direction of the satellite with which the user terminal is communicating.'
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_direction_azimuth"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: a2c2d8f3fda744a19869e56748acbb7c
          name: 'Starlink direction elevation'
          type: DEPENDENT
          key: starlink.direction_elevation
          delay: '0'
          value_type: FLOAT
          description: 'Elevation angle, in degrees, of the direction in which the user terminal''s dish antenna is physically pointing.'
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_direction_elevation"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: 9eddc255499a49c58cc3e9e8c006d70b
          name: 'Starlink downlink throughput bps'
          type: DEPENDENT
          key: starlink.downlink
          delay: '0'
          value_type: FLOAT
          units: bps
          description: 'Most recent sample value. See bulk history data for detail.'
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_downlink_throughput_bps"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: traffic
        -
          uuid: 25b2a4cb5a34497494b0d1c7382d14c1
          name: 'Starlink fraction obstructed'
          type: DEPENDENT
          key: starlink.fraction_obstructed
          delay: '0'
          value_type: FLOAT
          description: 'The fraction of total area (or possibly fraction of time?) that the user terminal has determined to be obstructed between it and the satellites with which it communicates.'
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_fraction_obstructed"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: obstructed
        -
          uuid: 195bfef3e2e34f88b2262e6831cc1f7b
          name: 'Starlink hardware version'
          type: DEPENDENT
          key: starlink.hardware_version
          delay: '0'
          trends: '0'
          value_type: CHAR
          description: 'A string identifying the user terminal hardware version.'
          inventory_link: HARDWARE
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - starlink_info
                - label
                - hardware_version
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: 170aa74e1e0c4f77a89279ac20075bb8
          name: 'Starlink ID'
          type: DEPENDENT
          key: starlink.id
          delay: '0'
          trends: '0'
          value_type: CHAR
          description: 'A string identifying the specific user terminal device that was reachable from the local network. Something like a serial number.'
          inventory_link: SERIALNO_A
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - starlink_info
                - label
                - id
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: fe67f6503c1f43449e8c9fcec7e63f15
          name: 'Starlink obstruction duration'
          type: DEPENDENT
          key: starlink.obstruction_duration
          delay: '0'
          value_type: FLOAT
          description: 'Average consecutive time, in seconds, the user terminal has detected its signal to be obstructed for a period of time that it considers "prolonged", or None if no such obstructions were recorded.'
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_obstruction_duration"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: c1cef4bed95a416186056146bcb7876c
          name: 'Starlink obstruction interval'
          type: DEPENDENT
          key: starlink.obstruction_interval
          delay: '0'
          value_type: FLOAT
          description: 'Average time, in seconds, between the start of such "prolonged" obstructions, or None if no such obstructions were recorded.'
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_obstruction_interval"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: 263a1720583c4958b1ce056c8b79a88f
          name: 'Starlink ping latency'
          type: DEPENDENT
          key: starlink.ping.latency
          delay: '0'
          value_type: FLOAT
          description: 'Most recent sample value. See bulk history data for detail.'
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_pop_ping_latency_ms(?:_seconds)?$"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: ping
        -
          uuid: e3443e88eaf1444bba1ffe7f1d843200
          name: 'Starlink pop ping drop rate'
          type: DEPENDENT
          key: starlink.pop.ping.drop_rate
          delay: '0'
          value_type: FLOAT
          description: 'Most recent sample value. See bulk history data for detail.'
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_pop_ping_drop_rate(?:_seconds)?$"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: ping
        -
          uuid: 04c793495b6947a9acdf6a23787a7a43
          name: 'Starlink seconds to first nonempty slot'
          type: DEPENDENT
          key: starlink.seconds.to.first.nonempty_slot
          delay: '0'
          value_type: FLOAT
          description: 'Amount of time from now, in seconds, until a satellite will be scheduled to be available for transmit/receive. See also *scheduled* in the bulk history data. May report as a negative number, which appears to indicate unknown time until next satellite scheduled and usually correlates with *state* reporting as other than "CONNECTED".'
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_seconds_to_first_nonempty_slot"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: 4987bda7c015407c9381630df684b753
          name: 'Starlink seconds obstructed'
          type: DEPENDENT
          key: starlink.seconds_obstructed
          delay: '0'
          value_type: FLOAT
          description: |
            The amount of time within the history buffer, in seconds, that the user terminal determined to be obstructed, regardless of whether or not packets were able to be transmitted or received.
            
            **OBSOLETE**: The user terminal no longer provides this data.
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_seconds_obstructed"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: obstructed
        -
          uuid: c5d2ea23e7fd42b4aebb804431ca51f9
          name: 'Starlink snr above noise floor'
          type: DEPENDENT
          key: starlink.snr_above_noise_floor
          delay: '0'
          value_type: FLOAT
          description: |
            Most recent sample value. See bulk history data for detail.
            
            **OBSOLETE**: The user terminal no longer provides this data.
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_is_snr_above_noise_floor"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: 80fcc3488a174bd485c19b2b67174cf2
          name: 'Starlink software version'
          type: DEPENDENT
          key: starlink.software_version
          delay: '0'
          trends: '0'
          value_type: CHAR
          description: 'A string identifying the software currently installed on the user terminal.'
          inventory_link: SOFTWARE
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - starlink_info
                - label
                - software_version
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
          triggers:
            -
              uuid: c1c1225f9c0b42a8be30327fad7ad974
              expression: 'last(/Starlink dish by Prom/starlink.software_version,#1)<>last(/Starlink dish by Prom/starlink.software_version,#2) and length(last(/Starlink dish by Prom/starlink.software_version))>0'
              name: 'Starlink firmware has changed'
              opdata: 'Current value: {ITEM.LASTVALUE1}'
              priority: INFO
              description: 'Firmware version has changed. Ack to close'
              manual_close: 'YES'
              tags:
                -
                  tag: scope
                  value: firmware
                -
                  tag: scope
                  value: notice
        -
          uuid: 5a2b78039e14457c800a5008f36c243e
          name: 'Starlink state'
          type: DEPENDENT
          key: starlink.state
          delay: '0'
          trends: '0'
          value_type: CHAR
          description: |
            As string describing the current connectivity state of the user terminal. One of: 
            
            "UNKNOWN", "CONNECTED", "BOOTING", "SEARCHING", "STOWED", "THERMAL_SHUTDOWN", "NO_SATS", "OBSTRUCTED", "NO_DOWNLINK", "NO_PINGS"
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - 'starlink_status_state{state=~".*"}==1'
                - label
                - state
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
          triggers:
            -
              uuid: 12af95d3146d4d0e85079d4b6eedfbdb
              expression: 'last(/Starlink dish by Prom/starlink.state,#1)<>last(/Starlink dish by Prom/starlink.state,#2) and length(last(/Starlink dish by Prom/starlink.state))>0'
              name: 'Starlink status has changed'
              opdata: 'Current value: {ITEM.LASTVALUE1}'
              priority: AVERAGE
              description: 'Status has changed. Ack to close'
              manual_close: 'YES'
              tags:
                -
                  tag: scope
                  value: status
        -
          uuid: d8425ce93204421ba0f49277ad960f09
          name: 'Starlink uplink throughput bps'
          type: DEPENDENT
          key: starlink.uplink
          delay: '0'
          value_type: FLOAT
          units: bps
          description: 'Most recent sample value. See bulk history data for detail.'
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_uplink_throughput_bps"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: traffic
        -
          uuid: c351946690074f1f9c5979baa0ae07e0
          name: 'Starlink uptime'
          type: DEPENDENT
          key: starlink.uptime
          delay: '0'
          value_type: FLOAT
          units: uptime
          description: |
            The amount of time, in seconds, since the user terminal last rebooted.
            
            Starlink uptime in 'N days, hh:mm:ss' format.
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_uptime_seconds(?:_seconds)?$"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
          triggers:
            -
              uuid: e4b671e098964a67a74a56de29dbae61
              expression: 'last(/Starlink dish by Prom/starlink.uptime)<10m'
              name: '{HOST.NAME} has been restarted (uptime < 10m)'
              priority: WARNING
              description: 'Uptime is less than 10 minutes'
              manual_close: 'YES'
              tags:
                -
                  tag: scope
                  value: notice
        -
          uuid: 0c5d6dbc2a764a8997106efc6faafe2e
          name: 'Starlink: Get dish data'
          type: HTTP_AGENT
          key: zbx.starlink.dish.data
          history: '0'
          trends: '0'
          value_type: TEXT
          url: '{$STARLINK.SCHEME}://{HOST.CONN}:{$STARLINK.PORT}/metrics'
          tags:
            -
              tag: component
              value: raw
          triggers:
            -
              uuid: 698c274870ed4db49d3d883ef48ea3a0
              expression: 'nodata(/Starlink dish by Prom/zbx.starlink.dish.data,30)=1'
              name: 'starlink_exporter is not available (or no data for 30m)'
              priority: HIGH
              description: 'Failed to fetch starlink metrics from starlink_exporter in time.'
              manual_close: 'YES'
              tags:
                -
                  tag: scope
                  value: availability
      tags:
        -
          tag: class
          value: hardware
        -
          tag: target
          value: starlink
      macros:
        -
          macro: '{$STARLINK.PORT}'
          value: '8080'
        -
          macro: '{$STARLINK.SCHEME}'
          value: http
      dashboards:
        -
          uuid: c9612c8a85794cd79fa94a7c19fa259b
          name: 'Starlink status'
          pages:
            -
              name: 'Ping & Alerts'
              widgets:
                -
                  type: graph
                  width: '12'
                  height: '6'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        host: 'Starlink dish by Prom'
                        name: 'Starlink ping'
                -
                  type: graph
                  x: '12'
                  width: '12'
                  height: '6'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        host: 'Starlink dish by Prom'
                        name: 'Starlink alerts'
            -
              name: Status
              widgets:
                -
                  type: graph
                  width: '10'
                  height: '6'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        host: 'Starlink dish by Prom'
                        name: 'Starlink traffic'
                -
                  type: item
                  x: '10'
                  'y': '3'
                  width: '10'
                  height: '3'
                  fields:
                    -
                      type: INTEGER
                      name: show
                      value: '2'
                    -
                      type: INTEGER
                      name: adv_conf
                      value: '1'
                    -
                      type: INTEGER
                      name: decimal_size
                      value: '15'
                    -
                      type: INTEGER
                      name: value_size
                      value: '25'
                    -
                      type: STRING
                      name: value_color
                      value: 0040FF
                    -
                      type: ITEM
                      name: itemid
                      value:
                        host: 'Starlink dish by Prom'
                        key: starlink.software_version
                -
                  type: item
                  x: '10'
                  width: '7'
                  height: '3'
                  fields:
                    -
                      type: INTEGER
                      name: show
                      value: '2'
                    -
                      type: INTEGER
                      name: adv_conf
                      value: '1'
                    -
                      type: STRING
                      name: value_color
                      value: 00FF00
                    -
                      type: ITEM
                      name: itemid
                      value:
                        host: 'Starlink dish by Prom'
                        key: starlink.state
                -
                  type: item
                  x: '17'
                  width: '7'
                  height: '3'
                  fields:
                    -
                      type: INTEGER
                      name: show
                      value: '2'
                    -
                      type: INTEGER
                      name: adv_conf
                      value: '1'
                    -
                      type: ITEM
                      name: itemid
                      value:
                        host: 'Starlink dish by Prom'
                        key: starlink.uptime
                -
                  type: item
                  x: '20'
                  'y': '3'
                  width: '4'
                  height: '3'
                  fields:
                    -
                      type: INTEGER
                      name: show
                      value: '2'
                    -
                      type: INTEGER
                      name: adv_conf
                      value: '1'
                    -
                      type: INTEGER
                      name: decimal_places
                      value: '0'
                    -
                      type: INTEGER
                      name: decimal_size
                      value: '25'
                    -
                      type: INTEGER
                      name: value_size
                      value: '35'
                    -
                      type: STRING
                      name: value_color
                      value: FF0000
                    -
                      type: ITEM
                      name: itemid
                      value:
                        host: 'Starlink dish by Prom'
                        key: starlink.alerts
        -
          uuid: b858a9c4e58e494496065be0993f42b8
          name: 'Starlink traffic'
          pages:
            -
              widgets:
                -
                  type: graph
                  width: '24'
                  height: '7'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        host: 'Starlink dish by Prom'
                        name: 'Starlink traffic'
      valuemaps:
        -
          uuid: ccba6d610c4d47b891b85a5dcb240fa7
          name: 'Starlink alerts'
          mappings:
            -
              value: '0'
              newvalue: Normal
            -
              value: '1'
              newvalue: 'Motors stuck'
            -
              value: '2'
              newvalue: 'Thermal shutdown'
            -
              value: '4'
              newvalue: 'Thermal throttle'
            -
              value: '8'
              newvalue: 'Unexpected location'
            -
              value: '16'
              newvalue: 'Mast not near vertical'
            -
              value: '32'
              newvalue: 'Slow ethernet speeds'
            -
              value: '64'
              newvalue: Roaming
            -
              value: '128'
              newvalue: 'Install pending'
            -
              value: '256'
              newvalue: 'Is heating'
            -
              value: '257'
              newvalue: 'Unknown ?'
            -
              value: '512'
              newvalue: 'Power supply thermal throttle'
            -
              value: '1024'
              newvalue: 'Is power save idle'
            -
              value: '2048'
              newvalue: 'Moving while not mobile'
            -
              value: '4096'
              newvalue: 'Moving fast while not aviation'
  graphs:
    -
      uuid: bc9e3c36e2bc45c4a5129abd5f73d6db
      name: 'Starlink alerts'
      show_work_period: 'NO'
      show_triggers: 'NO'
      graph_items:
        -
          drawtype: DOTTED_LINE
          color: FF0000
          calc_fnc: MIN
          item:
            host: 'Starlink dish by Prom'
            key: starlink.alerts
    -
      uuid: 3c35a85188534f4889d4666fdf559538
      name: 'Starlink ping'
      graph_items:
        -
          drawtype: BOLD_LINE
          color: 199C0D
          calc_fnc: ALL
          item:
            host: 'Starlink dish by Prom'
            key: starlink.ping.latency
        -
          sortorder: '1'
          drawtype: BOLD_LINE
          color: F63100
          calc_fnc: ALL
          item:
            host: 'Starlink dish by Prom'
            key: starlink.pop.ping.drop_rate
    -
      uuid: 00bbfde1dab342f88eea28cdc15d462c
      name: 'Starlink traffic'
      graph_items:
        -
          drawtype: FILLED_REGION
          color: 199C0D
          calc_fnc: ALL
          item:
            host: 'Starlink dish by Prom'
            key: starlink.downlink
        -
          sortorder: '1'
          drawtype: FILLED_REGION
          color: 0040FF
          calc_fnc: ALL
          item:
            host: 'Starlink dish by Prom'
            key: starlink.uplink
