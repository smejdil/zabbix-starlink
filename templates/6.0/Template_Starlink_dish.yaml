zabbix_export:
  version: '6.0'
  date: '2023-04-13T08:27:02Z'
  groups:
    -
      uuid: 7df96b18c230490a9a0a9e2307226338
      name: Templates
  templates:
    -
      uuid: 68ad921d58194cd99f28b8967dfc5c4c
      template: 'Starlink dish by Prom'
      name: 'Starlink dish by Prom'
      description: |
        Use project Python starlink-grpc-tools
        
        https://github.com/sparky8512/starlink-grpc-tools
        
        Run Starlink exporter:
        python dish_grpc_prometheus.py status
      groups:
        -
          name: Templates
      items:
        -
          uuid: 0016a5b73e574ffd92f3658a7bc237e1
          name: 'Starlink alerts'
          type: DEPENDENT
          key: starlink.alerts
          delay: '0'
          value_type: FLOAT
          valuemap:
            name: 'Starlink alerts'
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_alerts"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: alert
          triggers:
            -
              uuid: 10a06ee48bb14b269d74dfb169313b7e
              expression: 'last(/Starlink dish by Prom/starlink.alerts,#3)>0'
              name: 'Starlink alert'
              opdata: 'Current value: {ITEM.LASTVALUE1}'
              priority: INFO
              description: 'Starlink alert. Ack to close'
              manual_close: 'YES'
              tags:
                -
                  tag: scope
                  value: notice
            -
              uuid: 83b0d39cc53f419c9b268a1e04cc0316
              expression: 'last(/Starlink dish by Prom/starlink.alerts,#3)=128'
              name: 'Starlink alert install pending'
              opdata: 'Current value: {ITEM.LASTVALUE1}'
              priority: WARNING
              description: 'Starlink alert install pending. Ack to close'
              manual_close: 'YES'
              tags:
                -
                  tag: scope
                  value: notice
        -
          uuid: 6907c805b7104aa8a0af94b58d2eaae4
          name: 'Starlink currently obstructed'
          type: DEPENDENT
          key: starlink.currently_obstructed
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_currently_obstructed"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: obstructed
        -
          uuid: 21bf718f682c4e16a6a7952ea7c0b9ec
          name: 'Starlink direction azimuth'
          type: DEPENDENT
          key: starlink.direction_azimuth
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_direction_azimuth"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: 8b8364416b8c4ca9bacf2240ed2c063b
          name: 'Starlink direction elevation'
          type: DEPENDENT
          key: starlink.direction_elevation
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_direction_elevation"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: 8030baf3eb3e48a5a172eebf57789684
          name: 'Starlink downlink throughput bps'
          type: DEPENDENT
          key: starlink.downlink
          delay: '0'
          value_type: FLOAT
          units: bps
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_downlink_throughput_bps"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: traffic
        -
          uuid: f7b2513d562d4abf8f3d5dd45e605dcd
          name: 'Starlink fraction obstructed'
          type: DEPENDENT
          key: starlink.fraction_obstructed
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_fraction_obstructed"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: obstructed
        -
          uuid: f714ad21ddfa4ab79f6ce249605470e5
          name: 'Starlink hardware version'
          type: DEPENDENT
          key: starlink.hardware_version
          delay: '0'
          trends: '0'
          value_type: CHAR
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - starlink_info
                - label
                - hardware_version
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: 8d3b5fe9f591489889f551636fdbb661
          name: 'Starlink ID'
          type: DEPENDENT
          key: starlink.id
          delay: '0'
          trends: '0'
          value_type: CHAR
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - starlink_info
                - label
                - id
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: 39d30608d1804ea587205834a7922075
          name: 'Starlink obstruction duration'
          type: DEPENDENT
          key: starlink.obstruction_duration
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_obstruction_duration"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: cfbc91f8db9c4b57b217cd54f4d58f1f
          name: 'Starlink obstruction interval'
          type: DEPENDENT
          key: starlink.obstruction_interval
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_obstruction_interval"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: 374caaf214f34bb1966c0b40783ff06f
          name: 'Starlink ping latency'
          type: DEPENDENT
          key: starlink.ping.latency
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_pop_ping_latency_ms(?:_seconds)?$"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: ping
        -
          uuid: 55402c56edf143ffa6e2486592826e3b
          name: 'Starlink pop ping drop rate'
          type: DEPENDENT
          key: starlink.pop.ping.drop_rate
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_pop_ping_drop_rate(?:_seconds)?$"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: ping
        -
          uuid: e14cead36d154f9fb6ecf37f312390af
          name: 'Starlink seconds to first nonempty slot'
          type: DEPENDENT
          key: starlink.seconds.to.first.nonempty_slot
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_seconds_to_first_nonempty_slot"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: 0af6867e82a34c1682452239a6ee1c44
          name: 'Starlink seconds obstructed'
          type: DEPENDENT
          key: starlink.seconds_obstructed
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_seconds_obstructed"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: obstructed
        -
          uuid: 671f05cd7db44fd18fd13c66ce95d482
          name: 'Starlink snr above noise floor'
          type: DEPENDENT
          key: starlink.snr_above_noise_floor
          delay: '0'
          value_type: FLOAT
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_is_snr_above_noise_floor"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
        -
          uuid: 367a1a29b87b4ec09952ef470f16ade9
          name: 'Starlink software version'
          type: DEPENDENT
          key: starlink.software_version
          delay: '0'
          trends: '0'
          value_type: CHAR
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - starlink_info
                - label
                - software_version
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
          triggers:
            -
              uuid: 8465e95a57574200a6d1710c37e372dd
              expression: 'last(/Starlink dish by Prom/starlink.software_version,#1)<>last(/Starlink dish by Prom/starlink.software_version,#2) and length(last(/Starlink dish by Prom/starlink.software_version))>0'
              name: 'Starlink firmware has changed'
              opdata: 'Current value: {ITEM.LASTVALUE1}'
              priority: INFO
              description: 'Firmware version has changed. Ack to close'
              manual_close: 'YES'
              tags:
                -
                  tag: scope
                  value: firmware
                -
                  tag: scope
                  value: notice
        -
          uuid: 06ecd96796554f158fb4843c1f0ec2d4
          name: 'Starlink state'
          type: DEPENDENT
          key: starlink.state
          delay: '0'
          trends: '0'
          value_type: CHAR
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - 'starlink_status_state{state=~".*"}==1'
                - label
                - state
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
          triggers:
            -
              uuid: ec5b87dc875e46e1adb7f383d0d9087c
              expression: 'last(/Starlink dish by Prom/starlink.state,#1)<>last(/Starlink dish by Prom/starlink.state,#2) and length(last(/Starlink dish by Prom/starlink.state))>0'
              name: 'Starlink status has changed'
              opdata: 'Current value: {ITEM.LASTVALUE1}'
              priority: AVERAGE
              description: 'Status has changed. Ack to close'
              manual_close: 'YES'
              tags:
                -
                  tag: scope
                  value: status
        -
          uuid: a9d9f64e2a264388ace3affc30114ba8
          name: 'Starlink uplink throughput bps'
          type: DEPENDENT
          key: starlink.uplink
          delay: '0'
          value_type: FLOAT
          units: bps
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_uplink_throughput_bps"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
            -
              tag: scope
              value: traffic
        -
          uuid: ef64e026726c49358753c7cb640d5025
          name: 'Starlink uptime'
          type: DEPENDENT
          key: starlink.uptime
          delay: '0'
          value_type: FLOAT
          units: uptime
          description: 'Starlink uptime in ''N days, hh:mm:ss'' format.'
          preprocessing:
            -
              type: PROMETHEUS_PATTERN
              parameters:
                - '{__name__=~"^starlink_status_uptime_seconds(?:_seconds)?$"}'
                - value
                - ''
          master_item:
            key: zbx.starlink.dish.data
          tags:
            -
              tag: component
              value: starlink
          triggers:
            -
              uuid: a171cdc12ccb4a2abe6a3afc35f339b9
              expression: 'last(/Starlink dish by Prom/starlink.uptime)<10m'
              name: '{HOST.NAME} has been restarted (uptime < 10m)'
              priority: WARNING
              description: 'Uptime is less than 10 minutes'
              manual_close: 'YES'
              tags:
                -
                  tag: scope
                  value: notice
        -
          uuid: 6c08bdc0958b43e391b85f1a29c0db12
          name: 'Starlink: Get dish data'
          type: HTTP_AGENT
          key: zbx.starlink.dish.data
          history: '0'
          trends: '0'
          value_type: TEXT
          url: '{$STARLINK.SCHEME}://{HOST.CONN}:{$STARLINK.PORT}/metrics'
          tags:
            -
              tag: component
              value: raw
          triggers:
            -
              uuid: 5b34b91abed54e1a8d890ceeda1fd32e
              expression: 'nodata(/Starlink dish by Prom/zbx.starlink.dish.data,30)=1'
              name: 'starlink_exporter is not available (or no data for 30m)'
              priority: HIGH
              description: 'Failed to fetch starlink metrics from starlink_exporter in time.'
              manual_close: 'YES'
              tags:
                -
                  tag: scope
                  value: availability
      tags:
        -
          tag: class
          value: hardware
        -
          tag: target
          value: starlink
      macros:
        -
          macro: '{$STARLINK.PORT}'
          value: '8080'
        -
          macro: '{$STARLINK.SCHEME}'
          value: http
      dashboards:
        -
          uuid: 53dec447e09e456db6efbcbe25a833c5
          name: 'Starlink status'
          pages:
            -
              name: 'Ping & Alerts'
              widgets:
                -
                  type: GRAPH_CLASSIC
                  width: '12'
                  height: '6'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        host: 'Starlink dish by Prom'
                        name: 'Starlink ping'
                -
                  type: GRAPH_CLASSIC
                  x: '12'
                  width: '12'
                  height: '6'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        host: 'Starlink dish by Prom'
                        name: 'Starlink alerts'
            -
              name: Status
              widgets:
                -
                  type: GRAPH_CLASSIC
                  width: '10'
                  height: '6'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        host: 'Starlink dish by Prom'
                        name: 'Starlink traffic'
                -
                  type: ITEM
                  x: '10'
                  width: '7'
                  height: '3'
                  fields:
                    -
                      type: INTEGER
                      name: show
                      value: '2'
                    -
                      type: INTEGER
                      name: adv_conf
                      value: '1'
                    -
                      type: STRING
                      name: value_color
                      value: 00FF00
                    -
                      type: ITEM
                      name: itemid
                      value:
                        host: 'Starlink dish by Prom'
                        key: starlink.state
                -
                  type: ITEM
                  x: '17'
                  width: '7'
                  height: '3'
                  fields:
                    -
                      type: INTEGER
                      name: show
                      value: '2'
                    -
                      type: INTEGER
                      name: adv_conf
                      value: '1'
                    -
                      type: ITEM
                      name: itemid
                      value:
                        host: 'Starlink dish by Prom'
                        key: starlink.uptime
                -
                  type: ITEM
                  x: '10'
                  'y': '3'
                  width: '10'
                  height: '3'
                  fields:
                    -
                      type: INTEGER
                      name: show
                      value: '2'
                    -
                      type: INTEGER
                      name: adv_conf
                      value: '1'
                    -
                      type: INTEGER
                      name: decimal_size
                      value: '15'
                    -
                      type: INTEGER
                      name: value_size
                      value: '25'
                    -
                      type: STRING
                      name: value_color
                      value: 0040FF
                    -
                      type: ITEM
                      name: itemid
                      value:
                        host: 'Starlink dish by Prom'
                        key: starlink.software_version
                -
                  type: ITEM
                  x: '20'
                  'y': '3'
                  width: '4'
                  height: '3'
                  fields:
                    -
                      type: INTEGER
                      name: show
                      value: '2'
                    -
                      type: INTEGER
                      name: adv_conf
                      value: '1'
                    -
                      type: INTEGER
                      name: decimal_places
                      value: '0'
                    -
                      type: INTEGER
                      name: decimal_size
                      value: '25'
                    -
                      type: INTEGER
                      name: value_size
                      value: '35'
                    -
                      type: STRING
                      name: value_color
                      value: FF0000
                    -
                      type: ITEM
                      name: itemid
                      value:
                        host: 'Starlink dish by Prom'
                        key: starlink.alerts
        -
          uuid: ea1e7cbf69364c54b876f230d15d6c25
          name: 'Starlink traffic'
          pages:
            -
              widgets:
                -
                  type: GRAPH_CLASSIC
                  width: '24'
                  height: '7'
                  fields:
                    -
                      type: GRAPH
                      name: graphid
                      value:
                        host: 'Starlink dish by Prom'
                        name: 'Starlink traffic'
      valuemaps:
        -
          uuid: 8b7854b7b5f34266a40772317a968c49
          name: 'Starlink alerts'
          mappings:
            -
              value: '0'
              newvalue: Normal
            -
              value: '1'
              newvalue: 'Motors stuck'
            -
              value: '2'
              newvalue: 'Thermal shutdown'
            -
              value: '4'
              newvalue: 'Thermal throttle'
            -
              value: '8'
              newvalue: 'Unexpected location'
            -
              value: '16'
              newvalue: 'Mast not near vertical'
            -
              value: '32'
              newvalue: 'Slow ethernet speeds'
            -
              value: '64'
              newvalue: Roaming
            -
              value: '128'
              newvalue: 'Install pending'
            -
              value: '256'
              newvalue: 'Is heating'
            -
              value: '257'
              newvalue: 'Unknown ?'
            -
              value: '512'
              newvalue: 'Power supply thermal throttle'
            -
              value: '1024'
              newvalue: 'Is power save idle'
            -
              value: '2048'
              newvalue: 'Moving while not mobile'
            -
              value: '4096'
              newvalue: 'Moving fast while not aviation'
  graphs:
    -
      uuid: 335b962a8f7a495a90904f264b03a2fb
      name: 'Starlink alerts'
      show_work_period: 'NO'
      show_triggers: 'NO'
      graph_items:
        -
          drawtype: DOTTED_LINE
          color: FF0000
          calc_fnc: MIN
          item:
            host: 'Starlink dish by Prom'
            key: starlink.alerts
    -
      uuid: aa36140bbcd048bb8d6e1e20a398b1e8
      name: 'Starlink ping'
      graph_items:
        -
          drawtype: BOLD_LINE
          color: 199C0D
          calc_fnc: ALL
          item:
            host: 'Starlink dish by Prom'
            key: starlink.ping.latency
        -
          sortorder: '1'
          drawtype: BOLD_LINE
          color: F63100
          calc_fnc: ALL
          item:
            host: 'Starlink dish by Prom'
            key: starlink.pop.ping.drop_rate
    -
      uuid: b1b948128e68417fab6f6a75d0dac4f5
      name: 'Starlink traffic'
      graph_items:
        -
          drawtype: FILLED_REGION
          color: 199C0D
          calc_fnc: ALL
          item:
            host: 'Starlink dish by Prom'
            key: starlink.downlink
        -
          sortorder: '1'
          drawtype: FILLED_REGION
          color: 0040FF
          calc_fnc: ALL
          item:
            host: 'Starlink dish by Prom'
            key: starlink.uplink
